
Before the examples: https://blog.sleeplessbeastie.eu/2013/09/25/how-to-backup-and-restore-installed-packages/

How to backup and restore installed packages
by Milosz Galazka on September 25, 2013 and tagged with Debian, System management, Package management

If you ever wondered about how to backup list of installed packages and then restore it on another machine then you need to know that it does not require anything more then three basic utilities - dpkg to import/export list of packages, apt-get to install selected packages and apt-mark to restore extended package states.

Backup and restore installed packages

Export list of the installed packages on the local machine to packages.list file.

local$ dpkg --get-selections > packages.list

On the remote machine you need to select packages exported in the previous step.

remote$ sudo dpkg --set-selections < packages.list

Execute update action on the remote machine.

remote$ sudo apt-get update

I assume that local machine is up to date.
Install earlier selected packages.

remote$ sudo apt-get -u dselect-upgrade

Backup and restore extended package states

Read apt-mark manual page to learn more about extended package states.
Export list of automatically installed packages.

local$ apt-mark showauto > package.states.auto.list

Export list of manually installed packages.

local$ apt-mark showmanual > package.states.manual.list

Export list of packages on hold.

local$ apt-mark showhold > package.states.hold.list

The last step on the remote machine is to import states exported a moment ago.

remote$ sudo apt-mark auto $(cat package.states.auto.list)
remote$ sudo apt-mark manual $(cat package.states.manual.list)
remote$ sudo apt-mark manual $(cat package.states.auto.list)


0) (for just packages)

So we create these two files:

$ apt-mark showauto > pkgs_auto.lst
$ apt-mark showmanual > pkgs_manual.lst

Then we restore the files in the target machine:

$ sudo apt-mark auto $(cat pkgs_auto.lst)
$ sudo apt-mark manual $(cat pkgs_manual.lst)


1)

sudo apt install apt-clone

sudo apt-clone clone /path/to/clone.tar.gz
#or
sudo apt-clone clone path-to/apt-clone-state-ubuntu-$(lsb_release -sr)-$(date +%F).tar.gz


sudo apt-clone restore path-to/apt-clone-state-ubuntu.tar.gz
#or for newer release
sudo apt-clone restore-new-distro path-to/apt-clone-state-ubuntu.tar.gz $(lsb_release -sc)


----
2)

dpkg --get-selections > ~/Package.list
sudo cp -R /etc/apt/sources.list* ~/
sudo apt-key exportall > ~/Repo.keys
rsync --progress /home/`whoami` /path/to/user/profile/backup/here


rsync --progress /path/to/user/profile/backup/here /home/`whoami`
sudo apt-key add ~/Repo.keys
sudo cp -R ~/sources.list* /etc/apt/
sudo apt-get update
sudo apt-get install dselect
sudo dpkg --set-selections < ~/Package.list
sudo apt-get dselect-upgrade -y


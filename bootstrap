#!/bin/bash

echo "This script assumes that curl is installed"

HERE=`pwd`

mkdir -p ~/bin
ln -s ~/.emacs.d/dot.sbt ~/.sbt
#ln -s ~/.emacs.d/dot.vimrc ~/.vimrc

# Ammonite Scala shell
mkdir ~/.ammonite
ln -s ~/.emacs.d/predef.scala ~/.ammonite/predef.scala

# SBT and coursier
cd ~/bin && unzip $HERE/sbt-launcher.zip
cd ~/bin && cat > ~/bin/sbt <<EOF
#!/bin/bash
$HOME/bin/sbt-launcher/sbt $@
EOF
chmod 755 ~/bin/sbt

curl -L -o ~/bin/coursier https://git.io/coursier
chmod 755 ~/bin/coursier

# Scala Markdown code notebook w/ ```scala mdoc
cat > ~/bin/notebook <<EOF
#!/bin/bash
#
# See https://scalameta.org/mdoc

SCALA=2.11
MDOC=1.2.10

IN=.
OUT=/tmp/notebook-$RANDOM

mkdir -p $IN
mkdir -p $OUT

coursier launch "org.scalameta:mdoc_$SCALA:$MDOC" $@ -- --in $IN --out $OUT --watch
EOF

# Clojure boot/lein
curl -fsSLo ~/bin/boot https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh
chmod 755 ~/bin/boot

curl -fsSLo ~/bin/lein https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein
chmod 755 ~/bin/lein

# Note: no 'latest' link in Maven's repo; have to upgrade this manually
cd ~/bin && curl -fsSLo maven-latest.tgz http://apache.claz.org/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
cd ~/bin && tar -xzvf maven-latest.tgz
cd ~/bin && ln -s apache-maven* maven
cd ~/bin && cat > ~/bin/mvn <<EOF
#!/bin/bash
export MAVEN_HOME=`pwd`/maven
export M2_HOME=`pwd`/maven
`pwd`/maven/bin/mvn $@
EOF
chmod 755 ~/bin/mvn

# Ammonite Scala shell
curl -L -o ~/bin/amm https://git.io/vo4w5 && chmod +x ~/bin/amm

cat >> ~/.bashrc <<EOF

export PATH="$PATH:~/bin"
EOF


echo "See the 'baseline' folder for common apps"
